{% extends "superhero.html" %}
{% block content %}
	<div class="col-lg-12">
		<div class="progress">
			<div class="progress-bar progress-bar-success" style="width: 70%"></div>
			<div class="progress-bar progress-bar-warning" style="width: 20%"></div>
			<div class="progress-bar progress-bar-danger" style="width: 10%"></div>
		</div>
		{% if modules %}
			{% for module in modules %}
				<div class="row">
					<div class="col-lg-8">
						<div class="bs-component">
							<div class="jumbotron">
								<h2>{{ module.name }} - <small>{{ module.description }}</small></h2>
								<small>Last update : {{ module.last_updated|date:"jS F Y H:i:s" }}</small>
								{% if module.watchers %}
									{% for watcher in module.watchers %}
										<h3>{{ watcher.name }}</h3>
										{% if watcher.monitors %}
											{% for monitor in watcher.monitors %}
												<div class="monitor" style="border-left:solid 1px #9aa8b5; padding-left: 20px; margin-bottom: 10px;">
												<h4 style="float: left">{{ monitor.name }}</h4>
													<p style="text-align: right;">
														{% if monitor.name == "PING" %}
														{{ monitor.data_avg|floatformat:-2 }}ms
													{% elif monitor.name == "AVAILABILITY" %}
													{{ monitor.data_avg|floatformat:3 }} %
													{% endif %}
													</p>
												<input type='hidden' name="monitor" value='{{ monitor.id }}' data-m="{% for data in monitor.data %}{{ data.value }},{% endfor %}"/>
													<div id="chart-{{ monitor.id }}" style="height: 200px; margin: 0 auto"></div>
													<script>
														$(function () {
															var interval = 10;
															var range_min = 14 * interval * 1000; // ms
															$('#container').highcharts({
																chart: {
																	zoomType: 'x'
																},
																title: {
																	text: 'Website average response time'
																},
																subtitle: {
																	text: document.ontouchstart === undefined ?
																			'Click and drag in the plot area to zoom in' :
																			'Pinch the chart to zoom in'
																},
																xAxis: {
																	type: 'datetime',
																	minRange: range_min // fourteen days
																},
																yAxis: {
																	title: {
																		text: 'ping'
																	}
																},
																legend: {
																	enabled: false
																},
																plotOptions: {
																	area: {
																		fillColor: {
																			linearGradient: { x1: 0, y1: 0, x2: 0, y2: 0},
																			stops: [
																				[0, Highcharts.getOptions().colors[0]],
																				[1, Highcharts.Color(Highcharts.getOptions().colors[2]).setOpacity(0).get('rgba')]
																			]
																		},
																		marker: {
																			radius: 2
																		},
																		lineWidth: 1,
																		states: {
																			hover: {
																				lineWidth: 1
																			}
																		},
																		threshold: null
																	}
																},

																series: [{
																	type: 'area',
																	name: 'Ping',
																	pointInterval: interval * 1000,
																	pointStart: Date.UTC(2014, 04, 28, 19, 44, 10),
																	data: []
																}]
															});
														});
													</script>
												</div>
											{% endfor %}
										{% endif %}
									{% endfor %}
								{% endif %}
							</div>
						</div>
						<div id="chart-container">
							<div id="detailed-chart" style="rx: 0; ry: 0; height: 200px; margin: 0 auto;"></div>
							<div id="chart" style="rx: 0; ry: 0; height: 200px; margin: 0 auto;"></div>
						</div>
					</div>
					<div class="col-lg-4">
						{% if not module.watchers %}
							<div class="alert alert-dismissable alert-info">
								<button type="button" class="close" data-dismiss="alert">×</button>
								<h4><strong>Help</strong></h4>
								<p>It seems that you didn't add any watcher to this module!</p>
								<p><a href="#" class="alert-link">Click Here</a></p>
							</div>
						{% endif %}
						<div class="alert alert-dismissable alert-success">
							<button type="button" class="close" data-dismiss="alert">×</button>
							<h4><strong>Well done!</strong></h4>
							<p>Everything works as expected!</p>
						</div>
						<div class="alert alert-dismissable alert-warning">
							<button type="button" class="close" data-dismiss="alert">×</button>
							<h4><strong>Warning!</strong></h4>
							<p>Best check your services, at least one of them seems to be
								unstable.</p>
						</div>
						<div class="alert alert-dismissable alert-danger">
							<button type="button" class="close" data-dismiss="alert">×</button>
							<h4><strong>Alert!</strong></h4>
							<p>Something went wrong, at least one of your service is down!</p>
						</div>
					</div>
				</div>
			{% endfor %}
		{% endif %}
	</div>
{% endblock %}

{% block scripts %}
	<script src="http://code.highcharts.com/highcharts.js"></script>
	<script src="http://code.highcharts.com/modules/exporting.js"></script>
	<script>

	</script>
{% endblock %}